<div class="bg-stone-50 dark:bg-stone-900 min-h-screen z-10 relative" data-controller="comments-toggle jump-to-top">
  <div class="absolute inset-0 bg-cover bg-center bg-no-repeat" style="background-image: url('<%= url_for(@chapter.fiction.cover) %>');"></div>
  <div class="absolute inset-0 bg-stone-50/95 dark:bg-stone-900/95"></div>

  <main class="relative z-10">
    <!-- Hero Section -->
    <%= render 'hero', chapter: @chapter, fiction: @chapter.fiction %>

    <!-- Main Content and Comments -->
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 lg:py-12">
      <div class="flex flex-col lg:flex-row gap-6 sm:gap-8 lg:gap-12">
        <!-- Content Section -->
        <div data-comments-toggle-target="contentSection" class="w-full lg:w-2/3">
          <%= render @chapter, previous_chapter: @previous_chapter, next_chapter: @next_chapter %>
        </div>

        <!-- Comments Section - Desktop Sidebar -->
        <div data-comments-toggle-target="commentsSection" class="hidden w-full lg:w-1/3 mt-8 lg:mt-0 transition-all duration-300">
          <!-- Support Creator Section -->
          <% if @chapter.fiction.scanlators.pluck(:bank_url).compact_blank.any? %>
            <%= render 'fictions/support', fiction: @chapter.fiction %>
          <% end %>

          <%= render 'comments/index', comments: @comments, comment: @comment, commentable: @commentable %>
        </div>
      </div>
    </div>

    <!-- Comments Sidebar - Mobile -->
    <div data-comments-toggle-target="commentsModal" class="fixed inset-0 z-50 hidden lg:hidden">
      <!-- Backdrop -->
      <div class="fixed inset-0 backdrop-blur-xs bg-white/5 dark:bg-black/5 transition-all" data-action="click->comments-toggle#closeModal"></div>

      <!-- Sidebar -->
      <div class="fixed top-0 right-0 h-full w-full max-w-sm bg-white dark:bg-gray-800 shadow-2xl transform translate-x-full transition-transform duration-300 ease-out overflow-hidden">

        <!-- Content -->
        <div class="h-full overflow-y-auto pb-4 mt-36 sm:mt-4">
          <div class="flex items-center justify-between p-4 border-b border-stone-200 dark:border-gray-700 bg-stone-50 dark:bg-gray-900">
            <button data-action="click->comments-toggle#closeModal" class="p-2 text-stone-500 dark:text-gray-400 hover:text-stone-700 dark:hover:text-gray-200 transition-colors rounded-full hover:bg-stone-200 dark:hover:bg-gray-700" aria-label="Закрити коментарі">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>

          <!-- Support Creator Section -->
          <% if @chapter.fiction.scanlators.pluck(:bank_url).compact_blank.any? %>
            <div class="px-4 pt-4">
              <%= render 'fictions/support', fiction: @chapter.fiction %>
            </div>
          <% end %>

          <div class="block px-4 pt-4 mb-36">
            <%= turbo_frame_tag "mobile_sidebar_comments" do %>
              <%= render 'comments/mobile_index', comments: @comments, comment: @comment, commentable: @commentable %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Jump to Top Button - Mobile Only -->
  <button id="jump-to-top" class="fixed bottom-6 right-6 z-50 bg-stone-600 dark:bg-gray-700 text-white p-3 rounded-full shadow-lg hover:bg-stone-700 dark:hover:bg-gray-600 transition-all duration-300 transform hover:scale-110 lg:hidden" style="display: none;">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
    </svg>
  </button>
</div>
